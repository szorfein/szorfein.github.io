---
layout: post-detail
title: vim and gpg with gnupg
date: 2017-08-11
categories: vim gpg password
description: Use vim with gpg like a password manager.
img-url: https://i.imgur.com/DzqtqXwl.jpg
comments: true
---

After generate a gnupg keypair like [here](), we will use vim for encrypt password with gpg.

### 1 - Download [gnupg plugin](http://www.vim.org/scripts/script.php?script_id=3645)
---

and place it in ~/.vim/plugin

```sh
$ mkdir -p ~/.vim/plugin
$ cp gnupg.vim ~/.vim/plugin/
```

### 2 - Edit your shell
---

We will add two news usefull function.
Look my script on [github](https://github.com/szorfein/dotfiles/blob/master/.zshrc) if need help.

```sh
$ mkdir ~/.passwords
$ vim ~/.zshrc
    PASSWORD_DIR="~/.passwords/"
    EDITOR="vim"

    buildfile() {
        if [[ "$1" == *.* ]]; then
            echo $1
        else
            if [ -e "$1" ]; then
                echo $1
            elif [ -e "$1".gpg ]; then
                echo "$1".gpg
            else 
                echo "$1".txt
            fi
        fi
    }

    pw() {
        cd "$PASSWORD_DIR"
        if [ ! -z "$1" ]; then
            $EDITOR $(buildfile "$1")
            cd "$OLDPWD"
        fi
    }
```

### 3 - Refresh our shell
---

```sh
$ source ~/.zshrc
```

### 4 - Edit vimrc
---

We need add some word in vimrc for use gnupg plugin.  
Exemple of config file on [github](https://github.com/szorfein/dotfiles/blob/master/.vimrc)

```sh
$ vim ~/.vimrc

    set cryptmethod=blowfish

    let mapleader=","
    imap <C-V> <ESC>
    nmap <leader>y
    vmap <leader>y

    if has("autocmd")
        let g:GPGPreferArmor=1
        let g:GPGPreferSign=1

        augroup GnuPGExtra
            autocmd BufReadCmd,FileReadCmd '*.\(gpg\|asc\|pgp\)' call SetGPGOptions()
            autocmd CursorHold '*.\(gpg\|asc\|pgp\)' quit
        augroup END

        function SetGPGOptions()
            set filetype=gpgpass
            set noswapfile
            set viminfo=
            set updatetime=30000
            set foldmethod=marker
            set foldclose=all
            set foldopen=insert
        endfunction
    endif
```

### 5 - Create our first password !
---

Before starting create password, we will need install two pwckages:
+ xclip for cut/paste to X clipboard 
+ pwgen for generate complex password like la5pu9S;#`y6VDDQO.3%^Ia%

Suppose than we need an account to [imgur](https://imgur.com/register), we create a file with 'pw' function from our shell.

example of pass   
```sh
$ pw imgur.gpg
```
![](/assets/imgs/vim-gpg.png)
{: .text-center }

Save and quit.

### 6 - Use our file for register to imgur.
---

Open our file with command pw and copy user, password & email for register to imgur.

```sh
$ pw imgur
```

Copy a username or password by placing the cursor on the first character Or select with mouse (visual mode) and hitting `<leader>+y` (leader = ',' in my case).

Here how we use plugin gnupg vim. think to do some backup reguliary.
